<!DOCTYPE html>
<html lang="be">
<head>
    <meta charset="utf-8" />
    <title>Каменны век на тэрыторыі Беларусі</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Падключэнне стыляў Leaflet (бібліятэка для мап) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; }
        #map { height: 100vh; width: 100%; }
        
        /* Стыль для панэлі кіравання знізу */
        #controls {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            text-align: center;
            width: 85%;
            max-width: 700px;
        }
        
        /* Стыль для адлюстравання года */
        #yearDisplay {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            display: block;
            margin-bottom: 15px;
            min-width: 200px;
        }
        
        /* Стыль паўзунка */
        input[type=range] {
            width: 100%;
            cursor: pointer;
            margin: 10px 0;
        }

        /* Дадатковая інфармацыя */
        .legend-hint {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        /* Стыль усплываючага акна (Popup) */
        .custom-popup h3 {
            margin: 0 0 5px 0;
            color: #d35400;
        }
        .custom-popup p {
            margin: 5px 0;
            font-size: 14px;
        }
        .custom-popup .dates {
            font-size: 12px;
            color: #555;
            font-style: italic;
            border-top: 1px solid #eee;
            padding-top: 5px;
            margin-top: 5px;
            display: block;
        }
    </style>
</head>
<body>

    <div id="controls">
        <span id="yearDisplay">Загрузка мапы...</span>
        <input type="range" id="yearSlider" min="0" max="100" value="0">
        <div class="legend-hint">Рухайце паўзунок, каб падарожнічаць у часе</div>
    </div>

    <div id="map"></div>

    <!-- Падключэнне скрыптоў -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-ajax/dist/leaflet.ajax.min.js"></script>

    <script>
        // 1. Ініцыялізацыя мапы (Цэнтр Беларусі)
        var map = L.map('map').setView([53.7, 28.0], 6);

        // Фонавая мапа (Светлая і нейтральная - CartoDB Positron)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        // 2. Генерацыя "Разумнай шкалы часу"
        var timeline = [];

        // Эпоха 1: Ледавік і Верхні палеаліт (ад -30 000 да -12 000)
        // Крок: 1000 гадоў (бо падзеі адбываліся павольна)
        for (let y = -30000; y < -12000; y += 1000) { timeline.push(y); }

        // Эпоха 2: Фінальны палеаліт і Мезаліт (ад -12 000 да -5 000)
        // Крок: 200 гадоў (больш падрабязна)
        for (let y = -12000; y < -5000; y += 200) { timeline.push(y); }

        // Эпоха 3: Неаліт і пераход да Бронзы (ад -5 000 да -1 500)
        // Крок: 100 гадоў (максімальная дэталізацыя)
        for (let y = -5000; y <= -1500; y += 100) { timeline.push(y); }

        // Налада паўзунка
        var slider = document.getElementById('yearSlider');
        var display = document.getElementById('yearDisplay');
        
        // Даўжыня паўзунка роўная колькасці кропак у часе
        slider.max = timeline.length - 1;
        slider.value = 0; // Старт з самага пачатку

        // Функцыя для прыгожага фарматавання года
        function formatYear(y) {
            if (y < 0) {
                return Math.abs(y) + " да н.э.";
            } else {
                return y + " н.э.";
            }
        }

        // 3. Загрузка дадзеных з файла
        var geojsonLayer = new L.GeoJSON.AJAX("data/all_cultures.geojson", {
            
            // Стылізацыя (колер бярэцца з уласцівасцяў geojson)
            style: function(feature) {
                return {
                    color: feature.properties.color || '#3388ff', // Калі колеру няма, будзе сіні
                    weight: 2,
                    fillOpacity: 0.5,
                    opacity: 0.8
                };
            },

            // Што паказваць пры кліку на аб'ект
            onEachFeature: function (feature, layer) {
                var props = feature.properties;
                var popupContent = "<div class='custom-popup'>" +
                    "<h3>" + props.name + "</h3>";
                
                if (props.description) {
                    popupContent += "<p>" + props.description + "</p>";
                }
                
                popupContent += "<span class='dates'>Час існавання: " + 
                                formatYear(props.startYear) + " — " + formatYear(props.endYear) + 
                                "</span></div>";

                layer.bindPopup(popupContent);
            },

            // Фільтрацыя (Галоўная магія часу)
            filter: function(feature) {
                // Бярэм бягучы год з паўзунка
                var index = parseInt(slider.value);
                var currentYear = timeline[index];
                
                // Правяраем: ці трапляе бягучы год у дыяпазон культуры
                // (startYear <= currentYear <= endYear)
                return (currentYear >= feature.properties.startYear && 
                        currentYear <= feature.properties.endYear);
            }
        });

        // Дадаем пласт на мапу
        geojsonLayer.addTo(map);

        // 4. Логіка руху паўзунка
        slider.addEventListener('input', function() {
            var index = parseInt(this.value);
            var currentYear = timeline[index];
            
            // Абнаўляем тэкст
            display.innerText = formatYear(currentYear);
            
            // Абнаўляем мапу (Leaflet перамалёўвае пласты згодна з фільтрам)
            geojsonLayer.refresh(); 
        });

        // Ініцыялізацыя пры старце (паказваем першы год)
        display.innerText = formatYear(timeline[0]);

    </script>
</body>
</html>